;----------------------------------------------------------------------
;			includes cc65
;----------------------------------------------------------------------
.feature string_escapes

.include "telestrat.inc"
.include "errno.inc"

;----------------------------------------------------------------------
;			includes SDK
;----------------------------------------------------------------------
.include "SDK.mac"
.include "types.mac"

;----------------------------------------------------------------------
;			include application
;----------------------------------------------------------------------

;----------------------------------------------------------------------
;				imports
;----------------------------------------------------------------------

;----------------------------------------------------------------------
;				exports
;----------------------------------------------------------------------
.export check_kernel_version

;----------------------------------------------------------------------
;                       Segments vides
;----------------------------------------------------------------------

;----------------------------------------------------------------------
;			Defines / Constantes
;----------------------------------------------------------------------
.pushseg
	.segment "RODATA"

.popseg

;----------------------------------------------------------------------
;				Page Zéro
;----------------------------------------------------------------------
.pushseg
	.segment "ZEROPAGE"
.popseg

;----------------------------------------------------------------------
;				Variables
;----------------------------------------------------------------------
.pushseg
	.segment "DATA"

.popseg

;----------------------------------------------------------------------
;			Programme principal
;----------------------------------------------------------------------
.segment "CODE"

;----------------------------------------------------------------------
;
; Entrée:
;	-
; Sortie:
;	C : 0-> version kernel compatible, 1-> version kernel incompatible
;	AY: Kernel version
;	X : modifié
;
; Variables:
;       Modifiées:
;               -
;       Utilisées:
;               -
; Sous-routines:
;       XVARS
;----------------------------------------------------------------------
.proc check_kernel_version
		; Version du kernel:A=X=Y=0 -> version >= 2020.4
		;ldx	#$06
		;.byte	$00, XVARS
		;jsr	PrintRegs

		ldx	#$06
		.byte $00, XVARS

		cpx	#$06
		beq	prior_2020_4

		cmp	#$01
		bcc	prior_2022_4
		clc
		rts

	prior_2022_4:
		sec
	prior_2020_4:
		rts
.endproc
